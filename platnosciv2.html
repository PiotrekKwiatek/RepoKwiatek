<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<title>Płatność składki – mBank QR</title>
<style>
  #qrcode canvas {
    margin-top: 10px;
    border: 1px solid #000;
  }
</style>
</head>
<body>

<h1>Opłać składkę – mBank QR</h1>

<label>Cel wpłaty:
<select id="cel">
  <option value="Składka maj 2025|50.00">Składka maj 2025 – 50 zł</option>
  <option value="Biwak wiosenny|120.00">Biwak wiosenny – 120 zł</option>
  <option value="Obóz letni|950.00">Obóz letni – 950 zł</option>
</select>
</label>
<br><br>

<label>Imię i nazwisko:
<input type="text" id="nazwisko" placeholder="Jan Kowalski" />
</label>
<br><br>

<button onclick="generujQR()">Generuj QR kod przelewu</button>

<div id="qrcode"></div>

<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<script>
function generujQR() {
  const celSelect = document.getElementById("cel");
  const [tytul, kwota] = celSelect.value.split("|");
  const nazwisko = document.getElementById("nazwisko").value.trim();

  if (!nazwisko) {
    alert("Proszę wpisać imię i nazwisko.");
    return;
  }

  const nrKonta = "PL61109010140000071219812874"; // <-- Twój numer konta IBAN (przykład mBank)
  const odbiorca = "Twoja Organizacja";

  // Format QR przelewu wg standardu EPC QR (Polski standard)
  // https://www.paylibo.com/qr-kody-przelewow
  const qrText =
    `BCD\n` +
    `001\n` +
    `1\n` +
    `SCT\n` +
    `${nrKonta}\n` +
    `${odbiorca}\n` +
    `\n` +  // adres odbiorcy - puste
    `${kwota}\n` +
    `PLN\n` +
    `${tytul} - ${nazwisko}\n` +
    `\n` + // info dodatkowe
    `\n`;  // info dodatkowe

  const qrcodeEl = document.getElementById("qrcode");
  qrcodeEl.innerHTML = "";

  const canvas = document.createElement("canvas");
  qrcodeEl.appendChild(canvas);

  QRCode.toCanvas(canvas, qrText, { width: 250 }, function (error) {
    if (error) {
      alert("Błąd generowania QR kodu: " + error);
      console.error(error);
    }
  });
}
</script>

</body>
</html>
